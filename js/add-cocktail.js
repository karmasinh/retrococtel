const ingredients = []

function opt(el, arr){ el.innerHTML=''; arr.forEach(v=>{ const o=document.createElement('option'); o.value=v; o.textContent=v; el.appendChild(o) }) }

async function loadMeta(){ const m = await window.apiClient.request('/cocktails/meta'); opt(document.getElementById('selCategories'), m.categories); opt(document.getElementById('selBases'), m.bases); opt(document.getElementById('selAromas'), m.aromatics); opt(document.getElementById('selGarnish'), m.garnish); opt(document.getElementById('selEffects'), m.effects); opt(document.getElementById('selTags'), m.tags) }

function addIngredient(){ const name=document.getElementById('ingName').value.trim(); const amount=parseFloat(document.getElementById('ingAmount').value||'0'); const unit=document.getElementById('ingUnit').value.trim()||'ml'; if(!name) return; ingredients.push({ name, amount, unit }); const li=document.createElement('li'); li.className='list-group-item d-flex justify-content-between align-items-center'; li.textContent=`${name} - ${amount} ${unit}`; const b=document.createElement('button'); b.className='btn btn-sm btn-outline-danger'; b.textContent='Quitar'; b.onclick=()=>{ const i=ingredients.findIndex(x=> x.name===name && x.amount===amount && x.unit===unit); if(i>=0){ ingredients.splice(i,1); li.remove() } }; li.appendChild(b); document.getElementById('ingList').appendChild(li) }

async function submitForm(e){ e.preventDefault(); const f=e.target; const data={ name:f.name.value.trim(), slug:f.slug.value.trim(), short_description:f.short_description.value.trim(), glass_type:f.glass_type.value.trim(), method:f.method.value, prep_time_minutes:parseInt(f.prep_time_minutes.value||'0',10), servings:parseInt(f.servings.value||'1',10), difficulty:f.difficulty.value, calories:parseInt(f.calories.value||'0',10), categories:[...document.getElementById('selCategories').selectedOptions].map(o=> o.value), bases:[...document.getElementById('selBases').selectedOptions].map(o=> o.value), aromatics:[...document.getElementById('selAromas').selectedOptions].map(o=> o.value), garnish:[...document.getElementById('selGarnish').selectedOptions].map(o=> o.value), effects:[...document.getElementById('selEffects').selectedOptions].map(o=> o.value), tags:[...document.getElementById('selTags').selectedOptions].map(o=> o.value), ingredients };
  const res = await window.apiClient.createCocktail(data); window.toastManager && window.toastManager.show('CÃ³ctel creado', 'success'); window.location.href='cocktails.html' }

document.addEventListener('DOMContentLoaded', ()=>{ if(!localStorage.getItem('authToken')){ window.location.href='login.html'; return } loadMeta(); document.getElementById('addIngBtn').addEventListener('click', addIngredient); document.getElementById('cocktailForm').addEventListener('submit', submitForm) })
